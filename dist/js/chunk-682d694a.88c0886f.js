(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-682d694a"],{"12db":function(t,e,r){"use strict";var s=r("b4f2"),a=r.n(s);a.a},"2f21":function(t,e,r){"use strict";var s=r("79e5");t.exports=function(t,e){return!!t&&s(function(){e?t.call(null,function(){},1):t.call(null)})}},"405e":function(t,e,r){"use strict";var s=r("4f70"),a=r.n(s);a.a},4136:function(t,e,r){"use strict";var s=r("603d"),a=r.n(s);a.a},"4f70":function(t,e,r){},"51a3":function(t,e,r){},"55dd":function(t,e,r){"use strict";var s=r("5ca1"),a=r("d8e8"),i=r("4bf8"),n=r("79e5"),c=[].sort,o=[1,2,3];s(s.P+s.F*(n(function(){o.sort(void 0)})||!n(function(){o.sort(null)})||!r("2f21")(c)),"Array",{sort:function(t){return void 0===t?c.call(i(this)):c.call(i(this),a(t))}})},"5b62":function(t,e,r){"use strict";var s=r("76d9"),a=r.n(s);a.a},"603d":function(t,e,r){},"6ec6":function(t,e,r){"use strict";var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("md-card",{staticClass:"md-elevation-0",attrs:{"md-with-hover":""}},[r("md-card-content",[r("md-field",{attrs:{"md-clearable":""}},[r("md-icon",[t._v("search")]),r("label",[t._v("Search for a user to add")]),r("md-input",{on:{input:t.startSearchUsers},model:{value:t.userSearch,callback:function(e){t.userSearch=e},expression:"userSearch"}})],1),r("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:t.searchInProgress,expression:"searchInProgress"}],attrs:{"md-mode":"indeterminate","md-diameter":20,"md-stroke":2}}),r("div",{staticClass:"md-layout xxxsearch-results xxxmd-elevation-1"},[t._l(t.foundUsers,function(e){return null!==t.userSearch&&t.foundUsers.length>0?r("md-chip",{key:e._id,staticClass:"md-primary",staticStyle:{margin:"3px"},attrs:{"md-clickable":""},on:{click:function(r){t.selectUser(e._id)}}},[t._v("\n      "+t._s(e.name)+" "+t._s(e.surname)+" "),e.company?r("span",{staticClass:"md-caption"},[t._v("("+t._s(e.company)+")")]):t._e()]):t._e()}),0!==t.foundUsers.length||""===t.userSearch||t.searchInProgress?t._e():r("div",{staticClass:"md-caption"},[t._v("\n      No users found. Try a different search!\n    ")])],2)],1)],1)},a=[],i=(r("20d6"),r("f7fe")),n=r.n(i),c=r("bc3a"),o=r.n(c),d={name:"UserSearch",props:{msg:String},data:function(){return{userSearch:"",foundUsers:[],searchInProgress:!1}},watch:{userSearch:function(t,e){""===t&&(this.foundUsers=[],this.searchInProgress=!1)}},methods:{selectUser:function(t){this.$emit("selected-user",t);var e=this.foundUsers.findIndex(function(e){return e._id===t});this.foundUsers.splice(e,1)},startSearchUsers:function(){this.searchInProgress=!0,this.searchUsers(this.userSearch)},searchUsers:n()(function(t){var e=this;""===t&&(this.foundUsers=[],this.searchInProgress=!1),t.length<3||o.a.post("/accounts/search",{searchString:t}).then(function(t){console.log(t),e.foundUsers=t.data.resources,t.data.resources.length>0&&e.$store.commit("ADD_USERS",t.data.resources),e.searchInProgress=!1}).catch(function(t){e.foundUsers=[],e.searchInProgress=!1})},1500)}},u=d,m=(r("4136"),r("2877")),l=Object(m["a"])(u,s,a,!1,null,"17f1dd98",null);l.options.__file="UserSearch.vue";e["a"]=l.exports},"76d9":function(t,e,r){},"7c41":function(t,e,r){"use strict";var s=r("9902"),a=r.n(s);a.a},8450:function(t,e,r){"use strict";var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.resource?r("md-card",{staticClass:"md-elevation-3"},[r("md-card-header",{staticClass:"bg-ghost-white"},[r("md-card-header-text",[r("div",{staticClass:"md-title"},[t._v("Description")]),r("div",{staticClass:"md-caption"},[t._v("What this "+t._s(t.isStream?"stream":"project")+" is about.")])])],1),r("md-card-content",[r("div",{directives:[{name:"show",rawName:"v-show",value:!t.editDescription,expression:"!editDescription"}]},[r("div",{domProps:{innerHTML:t._s(t.compiledDescription)}})]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.editDescription,expression:"editDescription"}]},[t._v("\n      Supports "),r("a",{attrs:{target:"_blank",href:"https://en.wikipedia.org/wiki/Markdown#Example"}},[t._v("markdown.")]),r("md-field",[r("md-textarea",{model:{value:t.resource.description,callback:function(e){t.$set(t.resource,"description",e)},expression:"resource.description"}})],1)],1)]),r("md-card-actions",[!1===t.editDescription&&t.canEdit?r("md-button",{staticClass:"md-primary",nativeOn:{click:function(e){t.editDescription=!0}}},[t._v("Edit description")]):t._e(),!0===t.editDescription?r("md-button",{staticClass:"md-primary",nativeOn:{click:function(e){return t.updateDescription(e)}}},[t._v("Done")]):t._e()],1),t.resource.baseProperties?r("md-card-content",{staticClass:"md-caption"},[r("span",[r("strong",[t._v("Units:")]),t._v(" "+t._s(t.resource.baseProperties.units))]),t._v(";\n    "),r("span",[r("strong",[t._v("Tolerance:")]),t._v(" "+t._s(t.resource.baseProperties.tolerance))]),t._v(".\n  ")]):t._e()],1):t._e()},a=[],i=(r("cadf"),r("551c"),r("097d"),r("f7fe"),r("0e54")),n=r.n(i),c={name:"DetailDescription",props:{resource:Object},computed:{compiledDescription:function(){return n()(this.resource.description,{sanitize:!0})},canEdit:function(){return!!this.isOwner||-1!==this.resource.canWrite.indexOf(this.$store.state.user._id)},isOwner:function(){return this.resource.owner===this.$store.state.user._id},isStream:function(){return this.resource.hasOwnProperty("streamId")}},data:function(){return{editDescription:!1}},methods:{updateDescription:function(){this.editDescription=!1,this.isStream?this.$store.dispatch("updateStream",{streamId:this.resource.streamId,description:this.resource.description}):this.$store.dispatch("updateProject",{_id:this.resource._id,description:this.resource.description})}}},o=c,d=(r("a345"),r("2877")),u=Object(d["a"])(o,s,a,!1,null,"36a299f6",null);u.options.__file="DetailDescription.vue";e["a"]=u.exports},9902:function(t,e,r){},a345:function(t,e,r){"use strict";var s=r("f59d"),a=r.n(s);a.a},b4f2:function(t,e,r){},cbaf:function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.project?r("div",{staticClass:"md-layout md-alignment-center-center"},[t.project.deleted?r("div",{staticClass:"md-layout-item md-size-100 text-center sticky-top"},[r("md-content",{staticClass:"md-accent md-caption md-layout md-alignment-center-center",staticStyle:{width:"100%",padding:"10px","border-radius":"2px"}},[r("div",{staticClass:"md-layout-item"},[t._v("This project is in your trashbin.")]),r("div",{staticClass:"md-layout-item"},[t.canEdit?r("md-button",{staticClass:"md-dense md-raised",nativeOn:{click:function(e){return t.restore(e)}}},[t._v(" Restore? ")]):t._e()],1)])],1):t._e(),r("div",{staticClass:"md-layout-item md-size-50 md-large-size-65 md-medium-size-100 detail-card"},[r("project-detail-title",{attrs:{project:t.project}}),r("detail-description",{attrs:{resource:t.project}}),r("br"),r("md-card",{attrs:{"md-with-hover":""}},[r("md-card-header",{staticClass:"bg-ghost-white"},[r("md-card-header-text",[r("h2",{staticClass:"md-title"},[r("md-icon",[t._v("group")]),t._v(" Team Members")],1),r("p",{staticClass:"md-caption"},[t._v("The following people will have access to the streams in this project, and will be able to view this project. Please note, users with higher privileges from other projects will not be downgraded or removed.")])])],1),r("md-card-content",[t.canEdit?r("user-search",{on:{"selected-user":t.addUserToTeam}}):t._e(),r("permission-table",{attrs:{project:t.project,"global-disabled":!t.canEdit},on:{"remove-user":function(t){},"move-user":function(t){}}})],1)],1),r("br"),r("project-detail-streams",{attrs:{project:t.project},on:{"selected-stream":t.addStream,"remove-stream":t.removeStream}})],1)]):r("div",{staticClass:"md-layout md-alignment-center-center",staticStyle:{height:"95vh"}},[r("div",{staticClass:"md-layout-item md-size-50"},[r("md-progress-bar",{attrs:{"md-mode":"indeterminate"}})],1)])])},a=[],i=(r("ac6a"),r("2909")),n=(r("7514"),r("cadf"),r("551c"),r("097d"),r("13bb")),c=r.n(n),o=r("c36e"),d=r.n(o),u=r("6ec6"),m=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.project?r("div",{},[0===t.allUsersPop.length?r("div",[t._v("\n      No sharing buddies so far!\n    ")]):t._e(),t._l(t.allUsersPop,function(e){return e?r("div",{class:{"md-layout md-alignment-center-left user":!0,"bg-ghost-white":e.isOwner}},[r("div",{staticClass:"md-layout-item md-size-10 md-small-hide"},[r("md-avatar",{staticClass:"md-avatar-icon md-small",style:{background:t.getHexFromString(e.name)}},[t._v(t._s(e.name.substring(0,1).toUpperCase()))])],1),r("div",{staticClass:"md-layout-item xxx-md-size-40 md-small-size-100"},[t._v("\n        "+t._s(e.name)+" "+t._s(e.surname)+" "),e.company?r("span",{staticClass:"md-caption"},[t._v("("+t._s(e.company)+")")]):t._e(),t._v(" "),e.isOwner?r("span",[r("strong",[t._v("owner")])]):t._e()]),r("div",{staticClass:"md-layout-item text-center "},[r("md-button",{class:{"md-dense md-raised-xx":!0,"md-primary":t.hasWritePermissionStreams(e._id)},attrs:{disabled:e.surname.includes("(that is you!)")||t.globalDisabled||e.isOwner},nativeOn:{click:function(r){t.changePermissionStreams(e._id)}}},[t._v("\n          "+t._s(t.hasWritePermissionStreams(e._id)?"write streams":"read streams")+"\n        ")])],1),r("div",{staticClass:"md-layout-item text-center"},[r("md-button",{class:{"md-dense md-raised-xx":!0,"md-primary":t.hasWritePermissionProject(e._id)},attrs:{disabled:e.surname.includes("(that is you!)")||t.globalDisabled||e.isOwner},nativeOn:{click:function(r){t.changePermissionProject(e._id)}}},[t._v("\n          "+t._s(t.hasWritePermissionProject(e._id)?"write project":"read project")+"\n        ")])],1),r("div",{staticClass:"md-layout-item text-center md-size-5"},[r("md-button",{staticClass:"md-dense-xxx md-icon-button md-accent",attrs:{disabled:e.surname.includes("(that is you!)")||t.globalDisabled||e.isOwner},nativeOn:{click:function(r){t.removeUser(e._id)}}},[r("md-icon",[t._v("delete")])],1)],1),r("div",{staticClass:"md-layout-item md-size-100"})]):t._e()})],2):t._e()])},l=[],p=(r("7f7f"),r("55dd"),{name:"PermissionTable",props:{project:Object,globalDisabled:{type:Boolean,default:!1}},computed:{canReadProject:function(){return this.project.canRead},canWriteProject:function(){return this.project.canWrite},canReadStreams:function(){return this.project.permissions.canRead},canWriteStreams:function(){return this.project.permissions.canWrite},allUsers:function(){return d()(Object(i["a"])(this.canReadProject).concat(Object(i["a"])(this.canWriteProject),Object(i["a"])(this.canReadStreams),Object(i["a"])(this.canWriteProject),[this.project.owner]))},allUsersPop:function(){var t=this;return 0===this.allUsers.length?[]:this.allUsers.map(function(e){var r=t.$store.state.users.find(function(t){return t._id===e});return r||t.$store.dispatch("getUser",{_id:e}),r&&(r.isOwner=r._id===t.project.owner),r}).sort(function(t,e){return t.name>e.name?1:-1})}},data:function(){return{}},methods:{hasWritePermissionStreams:function(t){return this.canWriteStreams.indexOf(t)>-1},hasWritePermissionProject:function(t){return this.canWriteProject.indexOf(t)>-1},changePermissionProject:function(t){var e=this.project.canWrite.indexOf(t)>-1,r=[],s=[],a=this.project.permissions.canWrite,n=this.project.permissions.canRead;e?(r=this.project.canWrite.filter(function(e){return e!==t}),s=d()(Object(i["a"])(this.project.canRead).concat([t]))):(s=this.project.canRead,r=d()(Object(i["a"])(this.project.canWrite).concat([t])),a=d()(Object(i["a"])(a).concat([t])),this.upgradeUser(t)),this.$store.dispatch("updateProject",{_id:this.project._id,permissions:{canRead:n,canWrite:a},canRead:s,canWrite:r})},changePermissionStreams:function(t){var e=this.project.permissions.canWrite.indexOf(t)>-1,r=[],s=[];e?(s=this.project.permissions.canWrite.filter(function(e){return e!==t}),r=d()(Object(i["a"])(this.project.permissions.canRead).concat([t]))):(r=this.project.permissions.canRead,s=d()(Object(i["a"])(this.project.permissions.canWrite).concat([t]))),this.$store.dispatch("updateProject",{_id:this.project._id,permissions:{canRead:r,canWrite:s}}),e?this.downgradeUser(t):this.upgradeUser(t)},upgradeUser:function(t){var e=this;this.project.streams.forEach(function(r){var s=e.$store.state.streams.find(function(t){return t.streamId===r});if(s){var a=d()(Object(i["a"])(s.canWrite).concat([t]));e.$store.dispatch("updateStream",{streamId:r,canWrite:a})}})},downgradeUser:function(t){var e=this;this.project.streams.forEach(function(r){var s=e.$store.state.streams.find(function(t){return t.streamId===r});if(s){var a,n,c=e.$store.state.projects.filter(function(t){return-1!==t.streams.indexOf(r)&&t._id!==e.project._id}),o=(a=Array.prototype).concat.apply(a,Object(i["a"])(c.map(function(t){return t.permissions.canRead}))),u=(n=Array.prototype).concat.apply(n,Object(i["a"])(c.map(function(t){return t.permissions.canWrite})));console.log(o);var m=s.canWrite,l=s.canRead;-1===u.indexOf(t)?(m=m.filter(function(e){return e!==t}),l=d()(Object(i["a"])(l).concat([t])),e.$store.dispatch("updateStream",{streamId:r,canWrite:m,canRead:l})):console.warn("User ".concat(t," has write permissions from another project on stream ").concat(r,". Will not change."))}})},removeUser:function(t){var e=this,r=this.project.permissions.canRead.filter(function(e){return e!==t}),s=this.project.permissions.canWrite.filter(function(e){return e!==t}),a=this.project.canRead.filter(function(e){return e!==t}),n=this.project.canWrite.filter(function(e){return e!==t});this.$store.dispatch("updateProject",{_id:this.project._id,permissions:{canRead:r,canWrite:s},canRead:a,canWrite:n}),this.project.streams.forEach(function(r){var s=e.$store.state.streams.find(function(t){return t.streamId===r});if(s){var a,n,c=e.$store.state.projects.filter(function(t){return-1!==t.streams.indexOf(r)&&t._id!==e.project._id}),o=(a=Array.prototype).concat.apply(a,Object(i["a"])(c.map(function(t){return t.permissions.canRead}))),d=(n=Array.prototype).concat.apply(n,Object(i["a"])(c.map(function(t){return t.permissions.canWrite}))),u=s.canWrite,m=s.canRead,l=!1;-1===o.indexOf(t)&&(m=s.canRead.filter(function(e){return e!==t}),l=!0),-1===d.indexOf(t)&&(u=s.canWrite.filter(function(e){return e!==t}),l=!0),l&&e.$store.dispatch("updateStream",{streamId:r,canRead:m,canWrite:u})}})}},mounted:function(){}}),h=p,f=(r("7c41"),r("2877")),v=Object(f["a"])(h,m,l,!1,null,"5eb52a00",null);v.options.__file="PermissionTableProject.vue";var j=v.exports,_=r("8450"),b=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("md-card",{attrs:{"md-with-hover":""}},[r("md-card-header",{staticClass:"bg-ghost-white"},[r("md-card-header-text",[r("h2",{staticClass:"md-title"},[r("md-icon",[t._v("import_export")]),t._v(" Streams")],1),r("p",{staticClass:"md-caption"},[t._v("These are this project's streams. Adding a stream here will automatically grant write permission to the project's team members."),t.canEdit?r("span",[r("br"),t._v(" "),r("md-divider"),r("br"),t._v("You can only add streams that you have write permissions to.")],1):t._e()])])],1),r("md-card-content",{staticClass:"md-layout"},[r("div",{staticClass:"md-layout-item md-size-100"},[t.canEdit?r("stream-search",{attrs:{"streams-to-omit":t.streams,"write-only":""},on:{"selected-stream":t.selectStream}}):t._e()],1),0===t.streams.length?r("div",{staticClass:"md-layout-item md-size-100"},[r("p",[t._v("This project has no streams. Add some using the form below!")])]):r("div",{staticClass:"md-layout-item md-size-100"},t._l(t.streams,function(e){return r("stream-card-small",{key:e,attrs:{streamId:e,removable:t.canEdit},on:{"remove-stream":t.removeStream}})}))])],1)},g=[],y=r("f7fe"),S=r.n(y),w=r("adc7"),O=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("md-card",{staticClass:"md-elevation-0",attrs:{"md-with-hover":""}},[r("md-card-content",[r("md-field",{attrs:{"md-clearable":""}},[r("md-icon",[t._v("search")]),r("md-input",{attrs:{spellcheck:"false",disabled:t.globalDisabled},on:{input:t.updateSearch},model:{value:t.searchfilter,callback:function(e){t.searchfilter=e},expression:"searchfilter"}}),r("label",[t._v("Search for a stream to add")])],1),r("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:t.searchInProgress,expression:"searchInProgress"}],attrs:{"md-mode":"indeterminate","md-diameter":20,"md-stroke":2}}),t.showSearchResults?r("div",{staticClass:"search-results"},[t._l(t.paginatedStreams,function(e){return t.filters.length>0?r("md-chip",{key:e.streamId,staticClass:"md-primary",staticStyle:{margin:"3px"},attrs:{"md-clickable":""},on:{click:function(r){t.selectStream(e.streamId)}}},[r("strong",[t._v(t._s(e.name))]),t._v(" "+t._s(e.streamId)+" "),t._l(e.tags,function(s){return e.tags?r("span",{staticStyle:{background:"#0B5DE8","border-radius":"3px","margin-right":"4px",padding:"1px"}},[t._v(" "+t._s(s)+" ")]):t._e()})],2):t._e()}),0===t.paginatedStreams.length?r("p",{staticClass:"md-caption"},[t._v("No streams found. Existing streams ignored.")]):t._e()],2):t._e()],1)],1)},P=[],x=(r("6762"),r("2fdb"),r("28a5"),{name:"StreamSearch",props:{streamsToOmit:{type:Array,default:function(){return[]}},globalDisabled:{type:Boolean,default:!1},writeOnly:Boolean},computed:{filteredStreams:function(){var t=this;return this.$store.getters.filteredStreams(this.filters).filter(function(e){return-1===t.streamsToOmit.indexOf(e.streamId)})},paginatedStreams:function(){var t=this,e=this.filteredStreams.slice(this.startIndex,this.endIndex);return this.writeOnly&&(e=e.filter(function(e){return e.owner===t.$store.state.user._id||e.canWrite.indexOf(t.$store.state.user._id)>-1})),e}},watch:{searchfilter:function(t){""===t?(this.showSearchResults=!1,this.searchInProgress=!1):this.searchInProgress=!0}},data:function(){return{searchfilter:"",filters:[],showSearchResults:!1,searchInProgress:!1}},methods:{selectStream:function(t){this.$emit("selected-stream",t)},updateSearch:S()(function(t){if(this.searchfilter=t,""!==t){this.showSearchResults=!0,this.searchInProgress=!1;try{var e=this.searchfilter.split(" ").map(function(t){return t.includes(":")?{key:t.split(":")[0],value:t.split(":")[1]}:t.includes("public")||t.includes("private")||t.includes("mine")||t.includes("shared")?{key:t,value:null}:{key:"name",value:t}});this.filters=e}catch(r){this.filters=[{key:"name",value:t}]}}else this.showSearchResults=!1},1e3)}}),$=x,W=(r("e9f9"),Object(f["a"])($,O,P,!1,null,"16406b3f",null));W.options.__file="StreamSearch.vue";var C=W.exports,R={name:"ProjectStreams",components:{StreamCardSmall:w["a"],StreamSearch:C},props:{project:Object},computed:{streams:function(){return this.project.streams?this.project.streams:[]},canEdit:function(){return this.project.owner===this.$store.state.user._id||this.project.canWrite.indexOf(this.$store.state.user._id)>-1}},watch:{},data:function(){return{}},methods:{selectStream:function(t){this.$emit("selected-stream",t)},removeStream:function(t){this.$emit("remove-stream",t)}}},U=R,I=(r("405e"),Object(f["a"])(U,b,g,!1,null,"5ce3bbf6",null));I.options.__file="ProjectDetailStreams.vue";var k=I.exports,D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("md-card",{staticClass:"md-elevation-0"},[r("h1",{staticClass:"md-display-1"},[r("router-link",{attrs:{to:"/projects"}},[t._v("Projects")]),t._v(" /\n    "),r("span",{staticClass:"project-name",attrs:{title:"Click to edit.",contenteditable:t.canEdit},domProps:{innerHTML:t._s(t.getName())},on:{blur:t.updateName,keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.updateNameEnter(e):null}}})],1),r("p",[t._v("\n    projectId: "),r("span",{staticStyle:{"user-select":"all"}},[r("md-chip",{staticClass:"md-accent"},[r("strong",[t._v(t._s(t.project._id))])])],1)]),r("md-divider"),r("md-chips",{staticClass:"stream-chips",attrs:{"md-placeholder":"add tags","md-disabled":"!canEdit"},on:{input:t.updateTags},model:{value:t.project.tags,callback:function(e){t.$set(t.project,"tags",e)},expression:"project.tags"}})],1)},E=[],T=(r("a481"),{name:"HelloWorld",props:{project:Object},computed:{canEdit:function(){return this.project.owner===this.$store.state.user._id||this.project.canWrite.indexOf(this.$store.state.user._id)>-1}},data:function(){return{}},methods:{updateNameEnter:function(t){var e=t.target.innerText.replace(/(\r\n|\n|\r)/gm," ");e!==this.project.name&&(this.project.name=e,t.target.blur(),this.$store.dispatch("updateProject",{_id:this.project._id,name:this.project.name}))},getName:function(){return this.project.name},updateName:function(t){var e=t.target.innerText.replace(/(\r\n|\n|\r)/gm," ");e!==this.project.name&&(this.project.name=e,this.$store.dispatch("updateProject",{_id:this.project._id,name:this.project.name}))},updateTags:S()(function(t){this.$store.dispatch("updateProject",{_id:this.project._id,tags:this.project.tags})},1e3)}}),z=T,N=(r("5b62"),Object(f["a"])(z,D,E,!1,null,"65e8b1e7",null));N.options.__file="ProjectDetailTitle.vue";var A=N.exports,B={name:"ProjectDetailView",components:{UserSearch:u["a"],PermissionTable:j,DetailDescription:_["a"],ProjectDetailStreams:k,ProjectDetailTitle:A},props:{},computed:{canEdit:function(){return this.project.owner===this.$store.state.user._id||this.project.canWrite.indexOf(this.$store.state.user._id)>-1},project:function(){var t=this;return this.$store.state.projects.find(function(e){return e._id===t.$route.params.projectId})},canReadProject:function(){return this.project.canRead},canWriteProject:function(){return this.project.canWrite},canReadStreams:function(){return this.project.permissions.canRead},canWriteStreams:function(){return this.project.permissions.canWrite},allUsers:function(){return d()(Object(i["a"])(this.canReadProject).concat(Object(i["a"])(this.canWriteProject),Object(i["a"])(this.canReadStreams),Object(i["a"])(this.canWriteProject),[this.project.owner]))}},data:function(){return{}},methods:{restore:function(){this.$store.dispatch("updateProject",{_id:this.project._id,deleted:!1})},addUserToTeam:function(t){var e=this,r={canWrite:d()(Object(i["a"])(this.project.permissions.canWrite).concat([t])),canRead:this.project.permissions.canRead},s=d()(Object(i["a"])(this.project.canRead).concat([t]));this.$store.dispatch("updateProject",{_id:this.project._id,permissions:r,canRead:s}),this.project.streams.forEach(function(r){var s=e.$store.state.streams.find(function(t){return t.streamId===r});if(s){var a=d()(Object(i["a"])(s.canWrite).concat([t]));e.$store.dispatch("updateStream",{streamId:r,canWrite:a})}else console.error("Failed to find ".concat(r," while updating permissions from project."))})},addStream:function(t){this.$store.dispatch("updateProject",{_id:this.project._id,streams:d()(Object(i["a"])(this.project.streams).concat([t]))});var e=this.$store.state.streams.find(function(e){return e.streamId===t}),r=d()(Object(i["a"])(e.canRead).concat(Object(i["a"])(this.project.permissions.canRead))),s=d()(Object(i["a"])(e.canWrite).concat(Object(i["a"])(this.project.permissions.canWrite)));this.$store.dispatch("updateStream",{streamId:t,canRead:r,canWrite:s})},removeStream:function(t){var e,r,s=this;console.log("remove ".concat(t));var a=this.project.streams.filter(function(e){return e!==t});this.$store.dispatch("updateProject",{_id:this.project._id,streams:a});var n=this.$store.state.projects.filter(function(e){return-1!==e.streams.indexOf(t)&&e._id!==s.project._id}),c=(e=Array.prototype).concat.apply(e,Object(i["a"])(n.map(function(t){return t.permissions.canRead}))),o=(r=Array.prototype).concat.apply(r,Object(i["a"])(n.map(function(t){return t.permissions.canWrite}))),d=this.$store.state.streams.find(function(e){return e.streamId===t}),u=d.canRead,m=d.canWrite,l=!1;this.allUsers.forEach(function(t){-1===o.indexOf(t)&&(m=m.filter(function(e){return e!==t}),l=!0),-1===c.indexOf(t)&&(u=u.filter(function(e){return e!==t}),l=!0)}),l&&this.$store.dispatch("updateStream",{streamId:t,canRead:u,canWrite:m})}},mounted:function(){var t=this,e=this.$store.state.projects.find(function(e){return e._id===t.$route.params.projectId});e?(this.$store.dispatch("getUser",{_id:e.owner}),c()(e.canRead,e.canWrite).forEach(function(e){return t.$store.dispatch("getUser",{_id:e})})):this.$store.dispatch("getProject",{_id:this.$route.params.projectId}).then(function(e){t.$store.dispatch("getUser",{_id:e.data.resource.owner}),c()(e.data.resource.canRead,e.data.resource.canWrite).forEach(function(e){return t.$store.dispatch("getUser",{_id:e})})}).catch(function(e){t.$store.state.isAuth?(t.$router.push("/projects"),console.log("you don't have permission.")):(console.log("should redirect to login"),t.$router.push("/login")),console.log(e)})}},H=B,M=(r("12db"),Object(f["a"])(H,s,a,!1,null,"5b789bbd",null));M.options.__file="ProjectDetail.vue";e["default"]=M.exports},e9f9:function(t,e,r){"use strict";var s=r("51a3"),a=r.n(s);a.a},f59d:function(t,e,r){}}]);
//# sourceMappingURL=chunk-682d694a.88c0886f.js.map